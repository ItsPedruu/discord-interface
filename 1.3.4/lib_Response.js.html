<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lib/Response.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Confirmation.html">Confirmation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Confirmation.html#.create">create</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Menu.html">Menu</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Menu.html#.create">create</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Pagination.html">Pagination</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Pagination.html#.create">create</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Response.html">Response</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Response.html#.create">create</a></span></li><li class="nav-heading">Events</li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Confirmation.html#event:confirmation">confirmation</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Confirmation.html#event:over">over</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Menu.html#event:categorySelected">categorySelected</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Menu.html#event:over">over</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Pagination.html#event:collect">collect</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Pagination.html#event:over">over</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Response.html#event:collected">collected</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Response.html#event:error">error</a></span></li><li class="nav-heading"><span class="nav-item-type type-event">E</span><span class="nav-item-name"><a href="Response.html#event:response">response</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/Response.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const CONSTANTS = require('../utils/Constants.js');
const EventEmitter = require('events').EventEmitter;
const {RichEmbed} = require('discord.js');

/**
 * Represents a Response Interface
 * @class
 */
class Response extends EventEmitter {
    /**
     * @param {Message} message The discord.js message object
     * @param {ResponseOptions} options Options for the Response Interface
     */
    constructor(channel, options) {
        super();

        if (!channel) throw new Error('Expected a channel.');
        if (!options) throw new Error('Expected options');

        if (!options.text || !options.userID) throw new Error('Expected options.text and options.userID');

        this.channel = channel;
        this.options = {...CONSTANTS.ResponseOptions, ...options};

        this.start();
    }

    async start() {
        const texts = typeof this.options.text == 'string' ? [this.options.text] : this.options.text;
        
        let responses = [];

        for (let text of texts) {
            const response = await this.collectMessage(text);

            if (!response) return this.emit('error');
            responses.push(response);
        }

        this.emit('collected', responses);
    }

    async collectMessage(text) {
        return new Promise(async resolve => {
            const message = await this.channel.send(new RichEmbed()
                .setDescription(text)
                .setColor(this.options.embedColor)
                .setTimestamp()
            );

            const filter = message => message.author.id == this.options.userID;
            this.collector = this.channel.createMessageCollector(filter, {max: 1, ...this.options});

            this.collector.on('collect', async response => {
                this.emit('response', response);

                if (message.channel.type != 'dm') await response.delete();

                if (!message.deleted) await message.delete();

                const userHasCancelled = response.content.toLowerCase() == 'cancel';
                if (userHasCancelled) return resolve(null);

                resolve(this.options.justContent ? this.options.returnInt ? parseInt(response.content) : response.content : response);
            });

            this.collector.on('end', async (_, reason) => {
                if (reason == 'time') {
                    await message.delete();
                    resolve(null);
                }
            });
        });
    }

    /**
     * Creates a Response Interface
     * @param {Message} message The discord.js message object
     * @param {ResponseOptions} options Options for the Response Interface
     */
    static create(channel, options) {
        return new Response(channel, options);
    }
}

/**
 * @event Response#response
 * @property {string} response The raw response collected each response assignment
 */

/**
 * Emitted when the response collected is either timed out or does not pass the filters
 * @event Response#error
 */

/**
 * Emitted when all the responses are collected
 * @event Response#collected
 * @property {array} responses The array of responses collected
 */

module.exports = Response;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a> using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
